import numpy as np
import matplotlib.pyplot as plt
from math import pi
from math import cos
from math import sin


from amat import AMat

DIM = 28

#train_data = AMat('mnist-rot/mnist_all_rotation_normalized_float_train_valid.amat').all[:20]
#test_data = AMat('mnist-rot/mnist_all_rotation_normalized_float_test.amat').all[:20]

## note: last entry is label
#x_train, y_train = train_data[:, :-1], train_data[:, -1:]
#x_test, y_test = test_data[:, :-1], test_data[:, -1:]

## reshape
#x_train = x_train.reshape(x_train.shape[0], 1, DIM, DIM)
#x_test = x_test.reshape(x_test.shape[0], 1, DIM, DIM)

#input_shape = x_train.shape[1:]  # should be (28, 28)

# TODO: normalize
def transform_input(M, x):
    v = np.zeros(x.shape)
    print x.shape
    for i in range(x.shape[0]):
        for j in range(x.shape[1]):
            c = np.matrix('{}; {}; 1'.format(i, j))
            ct = M * c
            # TODO: add interpolation
            ct = ct.astype(int)
            if ct.item(0) < x.shape[0] and ct.item(1) < x.shape[1]:
                print ct.item(0), ct.item(1)
                v[i][j] = x.item(ct.item(0), ct.item(1))
    return v


x_in = [
    0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000012, 0.001633, 0.000034, 0.000604, 0.000033, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000803, 0.085931, 0.444140, 0.125640, 0.012553, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000004, 0.000000, 0.000000, 0.000000, 0.000001, 0.139151, 0.677539, 0.880570, 0.847293, 0.344201, 0.000226, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000009, 0.001751, 0.162511, 0.000000, 0.000000, 0.000000, 0.000000, 0.012614, 0.222920, 0.971239, 0.990964, 0.569186, 0.026359, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000014, 0.002992, 0.253516, 0.834339, 0.859986, 0.000000, 0.000000, 0.000000, 0.000000, 0.000108, 0.191765, 0.829951, 0.991045, 0.846782, 0.478313, 0.000127, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000007, 0.002500, 0.216612, 0.789104, 0.868304, 0.960208, 0.943227, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.027767, 0.314487, 0.991397, 0.990240, 0.531686, 0.011758, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.001326, 0.082786, 0.347130, 0.575635, 0.980718, 0.963731, 0.533508, 0.183095, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000270, 0.273163, 0.911316, 0.992170, 0.733543, 0.419560, 0.000067, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000021, 0.043231, 0.387060, 0.977246, 0.947101, 0.640829, 0.378133, 0.160179, 0.000853, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000001, 0.046794, 0.330179, 0.991751, 0.988699, 0.563152, 0.008381, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000003, 0.002397, 0.349005, 0.774306, 0.950701, 0.991581, 0.437035, 0.124365, 0.001132, 0.000005, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000488, 0.278636, 0.944792, 0.992161, 0.724706, 0.357545, 0.000029, 0.000000, 0.000000, 0.000000, 0.000001, 0.016496, 0.293671, 0.773332, 0.985657, 0.957924, 0.386869, 0.090975, 0.000018, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000002, 0.074407, 0.364918, 0.991737, 0.984093, 0.239742, 0.001933, 0.000000, 0.000000, 0.000009, 0.002705, 0.266412, 0.828450, 0.986673, 0.655068, 0.353311, 0.110149, 0.000407, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000885, 0.198651, 0.921699, 0.988584, 0.406365, 0.102856, 0.000006, 0.000000, 0.007352, 0.361961, 0.754348, 0.987218, 0.894341, 0.137976, 0.000870, 0.000004, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000002, 0.062093, 0.376500, 0.981897, 0.961398, 0.191933, 0.000344, 0.001858, 0.208581, 0.960274, 0.963966, 0.494328, 0.355370, 0.066136, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.001578, 0.540631, 0.982866, 0.886670, 0.133927, 0.195901, 0.629348, 0.710447, 0.971498, 0.805103, 0.120934, 0.001468, 0.000004, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000021, 0.333166, 0.738933, 0.961552, 0.624280, 0.433701, 0.977507, 0.973138, 0.525854, 0.091692, 0.005715, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.007844, 0.866483, 0.990128, 0.984184, 0.985816, 0.632873, 0.491917, 0.185289, 0.002095, 0.000003, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000063, 0.530632, 0.828011, 0.745912, 0.849783, 0.319190, 0.001702, 0.000009, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.005968, 0.308226, 0.113798, 0.031870, 0.058599, 0.000152, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000005, 0.000238, 0.000002, 0.000047, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 7.000000
]
x_in = x_in[:-1]
x_in = np.matrix([x_in])
x_in = x_in.reshape(x_in.shape[0], DIM, DIM)


theta = .5
M = np.matrix('{}, {}, {}; {}, {}, {}'.format(cos(theta), -sin(theta), 0, sin(theta), cos(theta), 0))
#M = np.matrix('1, 0, 1; 0, 1, 4')
x_trans = transform_input(M, x_in)
theta = .3
M2 = np.matrix('{}, {}, {}; {}, {}, {}'.format(cos(theta), -sin(theta), 0, sin(theta), cos(theta), 0))
x_trans2 = transform_input(M2, x_in)

# subplot
plt.subplot(221)
plt.imshow(x_in)
plt.subplot(222)
plt.imshow(x_trans)
plt.subplot(223)
plt.imshow(x_trans2)
#plt.imshow(X_train[101].reshape(DIM, DIM), cmap='gray', interpolation='none')
plt.show()
